ABSOLUTE CONTEXT (READ FIRST â€” NON-NEGOTIABLE)

You are working on AaRa, a health-critical fat-loss application.

The app is currently unstable due to state mismanagement, premature navigation, and missing guardrails, causing:

blank / error pages

delayed UI updates

fluctuating meal counts

unsafe or unclear water tracking

broken meal regeneration flow

âŒ Do NOT add new features
âŒ Do NOT add hacks, refreshes, or delays
âŒ Do NOT rely on navigation to update UI
âŒ Do NOT regenerate meals unless explicitly requested

Your ONLY goal is to stabilize state, fix navigation flow, and make UI deterministic and real-time.

CONFIRMED ISSUES (ALL MUST BE FIXED)
1ï¸âƒ£ Water tracking

No minus (â€“) button to subtract water

Water updates backend but not UI in real time

No indication when water intake is excessive or unnecessary

2ï¸âƒ£ Meal regeneration flow (CRITICAL)

Meal regenerates correctly

Clicking â€œOKâ€ redirects to error / blank page

Going back to dashboard shows regenerated meal

Redirect after regeneration is incorrect behavior

3ï¸âƒ£ Dashboard meal fluctuation (CRITICAL)

Meal count changes randomly (4 â†’ 5 â†’ 4)

Navigating to â€œmeal data not foundâ€ mutates dashboard

Meals are being recreated or appended incorrectly

4ï¸âƒ£ â€œMark as consumedâ€ feels disconnected

Action updates something but not:

dashboard

daily nutrition

progress tracker

Indicates fragmented state updates

ROOT CAUSE (YOU MUST CONFIRM)

The app is suffering from premature navigation and fragmented state:

Navigation occurs before global state is committed

Screens render with null / undefined data

Meals are recreated on navigation instead of referenced

UI is not subscribed to a single source of truth

You must explicitly confirm:

â€œThese issues occur because navigation and rendering happen before shared global state updates are finalized, and meal structure is not fixed.â€

ğŸ”’ CORE ARCHITECTURAL FIX (MANDATORY)
âœ… 1. SINGLE SOURCE OF TRUTH (GLOBAL STATE)

The following MUST live in one shared global state:

water intake

daily meal slots

meal contents

meal consumption status

daily nutrition summary

âŒ No screen may rely on local component state for these
âŒ No state may be recalculated on navigation

ğŸ” FIX DAILY MEAL COUNT (VERY IMPORTANT)
âœ… A. MEAL COUNT DECIDED AT ONBOARDING

During the mandatory onboarding / questionnaire:

Compute or ask for meals per day

Decide once (e.g. 3 / 4 / 5 meals)

Store as a user-level configuration

Example:

user.dailyMealCount = N


Rules:

Meal count is FIXED for the day

Read-only during the day

Can only change via explicit preference update + full-day regeneration

âœ… B. CREATE DAILY MEAL SLOTS ONCE

At start of day / first app open:

Read user.dailyMealCount

Create EXACTLY N meal slots

Persist them

Lock structure for the day

âŒ Do NOT create meals on navigation
âŒ Do NOT append meals dynamically
âŒ Do NOT recreate meals when data is missing

âœ… C. REGENERATION MUST BE IN-PLACE

When regenerating a meal:

Replace content of the selected meal slot ONLY

NEVER add or remove meal slots

NEVER change meal count

ğŸš¨ FIX MEAL REGENERATION FLOW (CRITICAL)
âŒ CURRENT (BROKEN)

OK â†’ navigate â†’ state not ready â†’ error page

âœ… REQUIRED FLOW

Regenerate meal API succeeds

Update global meal state

UI immediately re-renders regenerated meal

â€œOKâ€ button only closes modal

NO navigation

If regeneration happens on the same screen, redirecting is a bug.

ğŸ’§ FIX WATER TRACKING (MANDATORY)
âœ… A. ADD SUBTRACT (â€“) WATER OPTION

Add minus button for each water increment

User can undo mistakes

Updates must:

reflect instantly in UI

update global state

sync backend

âœ… B. DEFINE SAFE WATER RANGE

Backend must define:

reasonable hydration range

upper safe threshold

When exceeded:

Do NOT block

Do NOT scare

Show calm guidance

Example:

â€œYouâ€™ve had enough water for now. Drinking more may not be necessary.â€

âœ… C. REAL-TIME WATER UI UPDATE

UI must update immediately on tap

No navigation required

Must use shared global state

ğŸ½ï¸ FIX â€œMARK AS CONSUMEDâ€ (MANDATORY)

â€œMark as consumedâ€ must update, from ONE action:

meal state

daily nutrition totals

dashboard

progress tracker

âŒ It must NOT be a standalone or local update
âŒ Navigation must not be required

ğŸ§­ NAVIGATION RULES (GLOBAL)

Navigation must be side-effect free

Navigation must NEVER:

generate meals

mutate state

change meal count

Navigation allowed ONLY after state is validated

ğŸ›‘ HARD UI GUARDS (NO BLANK PAGES)

Every screen must:

handle loading state

handle missing data state

NEVER render null

NEVER show blank / white page

If data is missing:

explain calmly and wait for user action

âœ… VALIDATION CHECKLIST (ALL MUST PASS)

â˜‘ Water can be added AND subtracted
â˜‘ Water updates instantly
â˜‘ Excess water shows calm guidance
â˜‘ Meal regeneration shows immediately
â˜‘ OK button never redirects
â˜‘ Dashboard meal count never fluctuates
â˜‘ Meals are fixed per day
â˜‘ â€œMeal data not foundâ€ does NOT create meals
â˜‘ Mark as consumed updates everywhere
â˜‘ No button can cause blank/error page

OUTPUT REQUIRED FROM YOU

You must return:

Exact root cause explanation

Where daily meal count is decided and stored

How meal slots are created and locked

What navigation was removed or delayed

How real-time UI updates were achieved

Proof blank pages are impossible now